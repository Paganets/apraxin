<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ê–ø—Ä–∞—à–∫–∏ ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–ø—É—Å–∞–º–∏, —ç—Ç–∞–∂–∞–º–∏ –∏ –ø–∞–≤–∏–ª—å–æ–Ω–∞–º–∏">
    <meta name="theme-color" content="#000000">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Äî –ö–∞—Ä—Ç–∞ –ê–ø—Ä–∞—à–∫–∏</title>
    
    <!-- Supabase Configuration (–ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ meta —Ç–µ–≥–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏) -->
    <meta name="supabase-anon-key" content="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhZ3B1dWNkbmtyendzbW5ieW1rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1MDMxMjYsImV4cCI6MjA4NjA3OTEyNn0.T3vEY9VfxIQ19AtWPkwk6xiqAZe6sEzG-Ke73olUPsY">
    <meta name="supabase-url" content="https://qagpuucdnkrzwsmnbymk.supabase.co">
    
    <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Supabase –∏–∑ <meta> —Ç–µ–≥–æ–≤ -->
    <script>
            window.SupabaseConfig = {
                url: document.querySelector('meta[name="supabase-url"]').content.trim(),
                anonKey: document.querySelector('meta[name="supabase-anon-key"]').content.trim()
            };
    </script>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-mobile-web-app-status-bar-style" content="black">
    
    <!-- –°—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/admin.css">

    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script src="js/floor-plan.service.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/data.js"></script>
</head>
<body>
    <!-- –®–ê–ü–ö–ê –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò -->
    <header class="admin-header">
        <div class="admin-header-title">
            <h1>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
        </div>
        <div class="admin-header-user" id="user-info">
            <span id="user-name">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            <button class="btn btn-primary" onclick="handleLogout()">–í—ã—Ö–æ–¥</button>
        </div>
    </header>

    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ -->
    <main class="app-main">
        <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
        <section class="stats-grid">
            <div class="stat-card" id="stat-pavilions-card" onclick="togglePavilionEditor()" style="cursor: pointer;">
                <div class="stat-number" id="stat-pavilions">0</div>
                <div class="stat-label">–ú–æ–∏ –ø–∞–≤–∏–ª—å–æ–Ω—ã</div>
            </div>
            <div class="stat-card" onclick="window.location.href='./discounts.html'" style="cursor: pointer;">
                <div class="stat-number" id="stat-discounts">0</div>
                <div class="stat-label">–°–∫–∏–¥–æ–∫</div>
            </div>
        </section>

        <!-- –û–°–ù–û–í–ù–ê–Ø –†–ê–ó–ú–ï–¢–ö–ê: –î–í–ï –ö–û–õ–û–ù–ö–ò -->
        <div class="admin-container">
            <!-- –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –§–û–†–ú–ê –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø -->
            <div class="edit-panel" id="pavilion-editor" style="display: none;">
                <h2 class="admin-section-title">–ö–æ—Ä–ø—É—Å ‚Üí –≠—Ç–∞–∂ ‚Üí –ü–∞–≤–∏–ª—å–æ–Ω</h2>

                <form id="pavilion-form">
                    <input type="hidden" id="pavilion-id" value="">
                    <input type="hidden" id="image-url" value="">
                    <!-- –ö–û–†–ü–£–° -->
                    <div class="form-group">
                        <label for="building-select">–ö–æ—Ä–ø—É—Å</label>
                        <select id="building-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–ø—É—Å</option>
                            <option value="A">–ö–æ—Ä–ø—É—Å A</option>
                            <option value="B">–ö–æ—Ä–ø—É—Å B</option>
                            <option value="C">–ö–æ—Ä–ø—É—Å C</option>
                            <option value="D">–ö–æ—Ä–ø—É—Å D</option>
                            <option value="33">–ö–æ—Ä–ø—É—Å 33</option>
                        </select>
                        <button type="button" class="btn btn-secondary" onclick="showAddBuildingModal()" style="margin-top: var(--spacing-sm);">–î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π –∫–æ—Ä–ø—É—Å</button>
                    </div>

                    <!-- –≠–¢–ê–ñ -->
                    <div class="form-group">
                        <label for="floor-input">–≠—Ç–∞–∂</label>
                        <select id="floor-input" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–∂</option>
                            <option value="1">1 —ç—Ç–∞–∂</option>
                            <option value="2">2 —ç—Ç–∞–∂</option>
                            <option value="3">3 —ç—Ç–∞–∂</option>
                            <option value="4">4 —ç—Ç–∞–∂</option>
                            <option value="5">5 —ç—Ç–∞–∂</option>
                        </select>
                    </div>

                    <!-- –ü–õ–ê–ù –≠–¢–ê–ñ–ê –ö–û–†–ü–£–°–ê 33 -->
                    <div class="form-group" id="floor-plan-container" style="display: none;">
                        <label>–ü–ª–∞–Ω —ç—Ç–∞–∂–∞ (–∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏)</label>
                        <div id="floor-plan-wrapper" style="
                            border: 2px solid var(--color-border); 
                            border-radius: var(--radius-md); 
                            overflow: auto; 
                            max-width: 100%; 
                            max-height: 70vh;
                            background: #f0f0f0; 
                            position: relative;
                            -webkit-overflow-scrolling: touch;
                        ">
                            <div style="position: relative; display: inline-block; min-width: 100%;">
                                <img id="floor-plan-image" src="images/floor-plans/building_33_floor_1.png" alt="–ü–ª–∞–Ω —ç—Ç–∞–∂–∞" style="
                                    width: auto; 
                                    max-width: none;
                                    height: auto; 
                                    display: block; 
                                    cursor: crosshair;
                                    min-width: 100%;
                                ">
                                <canvas id="floor-plan-canvas" style="position: absolute; top: 0; left: 0; cursor: crosshair; display: none;"></canvas>
                            </div>
                        </div>
                        <div style="font-size: var(--font-size-xs); color: var(--color-text-light); margin-top: var(--spacing-xs); padding: 8px; background: #e8f4f8; border-radius: 4px; display: none;" id="coords-display">
                            üí° –í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–∂, –∑–∞—Ç–µ–º –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ø–ª–∞–Ω–µ –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ –ø–∞–≤–∏–ª—å–æ–Ω–∞
                        </div>
                        <input type="hidden" id="pavilion-x" value="">
                        <input type="hidden" id="pavilion-y" value="">
                    </div>

                    <!-- –ù–û–ú–ï–† –ü–ê–í–ò–õ–¨–û–ù–ê -->
                    <div class="form-group">
                        <label for="location-input">–ù–æ–º–µ—Ä –ø–∞–≤–∏–ª—å–æ–Ω–∞ (–≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –∫–æ—Ä–ø—É—Å–µ –Ω–∞ —ç—Ç–∞–∂–µ) *</label>
                        <input type="text" id="location-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 123, A-45" required>
                    </div>

                    <!-- –ù–ê–ó–í–ê–ù–ò–ï –ú–ê–ì–ê–ó–ò–ù–ê -->
                    <div class="form-group">
                        <label for="name-input">–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞ *</label>
                        <input type="text" id="name-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞" required>
                    </div>

                    <!-- –ö–ê–¢–ï–ì–û–†–ò–Ø -->
                    <div class="form-group">
                        <label for="category-select">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                        <select id="category-select" class="form-select" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                            <option value="clothing">–û–¥–µ–∂–¥–∞</option>
                            <option value="shoes">–û–±—É–≤—å</option>
                            <option value="accessories">–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</option>
                            <option value="electronics">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</option>
                            <option value="cosmetics">–ö–æ—Å–º–µ—Ç–∏–∫–∞</option>
                            <option value="sports">–°–ø–æ—Ä—Ç</option>
                            <option value="other">–ü—Ä–æ—á–µ–µ</option>
                        </select>
                        <button type="button" class="btn btn-secondary" onclick="showAddCategoryModal()" style="margin-top: var(--spacing-sm);">–î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                        <input type="hidden" id="category-input" required>
                    </div>

                    <!-- –ó–ê–ì–†–£–ó–ö–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø -->
                    <div class="form-group">
                        <label for="image-input">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–º–∞–∫—Å. 2 –ú–ë)</label>
                        <div class="image-upload-area" onclick="document.getElementById('image-input').click()">
                            <p>–ö–ª–∏–∫–Ω–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</p>
                        </div>
                        <input type="file" id="image-input" accept="image/*" style="display: none;">
                        <img id="image-preview" class="image-preview" style="display: none;">
                    </div>

                    <!-- –¶–í–ï–¢ –ë–†–ï–ù–î–ò–†–û–í–ê–ù–ò–Ø -->
                    <div class="form-group">
                        <label>–¶–≤–µ—Ç –±—Ä–µ–Ω–¥–∏—Ä–æ–≤–∞–Ω–∏—è</label>
                        <div class="color-palette" id="color-palette">
                            <div class="color-option" style="background: #E91E63" data-color="#E91E63" title="–†–æ–∑–æ–≤—ã–π"></div>
                            <div class="color-option" style="background: #9C27B0" data-color="#9C27B0" title="–§–∏–æ–ª–µ—Ç–æ–≤—ã–π"></div>
                            <div class="color-option" style="background: #2196F3" data-color="#2196F3" title="–°–∏–Ω–∏–π"></div>
                            <div class="color-option" style="background: #00BCD4" data-color="#00BCD4" title="–ì–æ–ª—É–±–æ–π"></div>
                            <div class="color-option" style="background: #4CAF50" data-color="#4CAF50" title="–ó–µ–ª—ë–Ω—ã–π"></div>
                            <div class="color-option" style="background: #8BC34A" data-color="#8BC34A" title="–°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π"></div>
                            <div class="color-option" style="background: #FFC107" data-color="#FFC107" title="–ñ—ë–ª—Ç—ã–π"></div>
                            <div class="color-option" style="background: #FF9800" data-color="#FF9800" title="–û—Ä–∞–Ω–∂–µ–≤—ã–π"></div>
                            <div class="color-option" style="background: #FF5722" data-color="#FF5722" title="–ö—Ä–∞—Å–Ω–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π"></div>
                            <div class="color-option" style="background: #F44336" data-color="#F44336" title="–ö—Ä–∞—Å–Ω—ã–π"></div>
                            <div class="color-option" style="background: #795548" data-color="#795548" title="–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π"></div>
                            <div class="color-option" style="background: #9E9E9E" data-color="#9E9E9E" title="–°–µ—Ä—ã–π"></div>
                        </div>
                        <input type="hidden" id="brand-color-input" value="#FF6B35">
                    </div>

                    <!-- –ö–ù–û–ü–ö–ò -->
                    <div style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-xl);">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button type="reset" class="btn btn-secondary" style="flex: 1;">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </form>
            </div>

            <!-- –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –ü–†–ï–î–ü–†–û–ú–û–¢–† –ö–ê–†–¢–´ -->
            <div class="preview-panel" style="display: none;">
                <h2 class="admin-section-title">–ö–∞—Ä—Ç–∞</h2>

                <!-- –í–´–ë–û–† –≠–¢–ê–ñ–ê -->
                <div class="map-section">
                    <h3>–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–∂:</h3>
                    <div class="floor-selector" id="floor-selector">
                        <button class="floor-btn active" data-floor="1" onclick="selectFloor(1)">1 —ç—Ç–∞–∂</button>
                        <button class="floor-btn" data-floor="2" onclick="selectFloor(2)">2 —ç—Ç–∞–∂</button>
                        <button class="floor-btn" data-floor="3" onclick="selectFloor(3)">3 —ç—Ç–∞–∂</button>
                        <button class="floor-btn" data-floor="4" onclick="selectFloor(4)">4 —ç—Ç–∞–∂</button>
                        <button class="floor-btn" data-floor="5" onclick="selectFloor(5)">5 —ç—Ç–∞–∂</button>
                    </div>
                </div>

                <!-- –ö–ê–†–¢–ê –ú–ò–ù–ò–ê–¢–Æ–†–ê -->
                <div class="map-section">
                    <div class="map-container-mini" id="map-mini">
                        <div class="map-hint">
                            <p>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–µ, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é –ø–∞–≤–∏–ª—å–æ–Ω–∞ –≤ –∫–æ—Ä–ø—É—Å–µ</p>
                        </div>
                        <div id="mini-map" style="width:100%; height:300px;"></div>
                    </div>
                </div>

                <!-- –ò–ù–§–û–†–ú–ê–¶–ò–Ø -->
                <div style="margin-top: var(--spacing-lg); padding: var(--spacing-md); background: var(--color-bg-light); border-radius: var(--radius-md);">
                    <p style="font-size: var(--font-size-sm); margin: 0;">
                        <strong>–°–æ–≤–µ—Ç:</strong> –í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–ø—É—Å, —ç—Ç–∞–∂ –∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–µ —Å–ø—Ä–∞–≤–∞, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–∞—à–µ–≥–æ –ø–∞–≤–∏–ª—å–æ–Ω–∞.
                    </p>
                </div>
            </div>
        </div>

        <!-- –°–ü–ò–°–û–ö –ü–ê–í–ò–õ–¨–û–ù–û–í (–ü–û –ö–û–†–ü–£–°–ê–ú –ò –≠–¢–ê–ñ–ê–ú) -->
        <section class="pavilions-list-section">
            <h2 class="admin-section-title">–ú–æ–∏ –ø–∞–≤–∏–ª—å–æ–Ω—ã (–ø–æ –∫–æ—Ä–ø—É—Å–∞–º)</h2>
            
            <div style="overflow-x: auto;">
                <table class="pavilions-table" id="pavilions-table">
                    <thead>
                        <tr>
                            <th>–ö–æ—Ä–ø—É—Å</th>
                            <th>–≠—Ç–∞–∂</th>
                            <th>–ù–æ–º–µ—Ä</th>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th>–°–∫–∏–¥–∫–∏</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="pavilions-table-body">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: var(--spacing-lg); color: var(--color-text-light);">
                                –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞–≤–∏–ª—å–æ–Ω–æ–≤ –∏–∑ –≤—Å–µ—Ö –∫–æ—Ä–ø—É—Å–æ–≤...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –î–û–ë–ê–í–ò–¢–¨ –ö–û–†–ü–£–° -->
    <div id="add-building-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä–ø—É—Å</h3>
                <button class="modal-close" onclick="hideAddBuildingModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="new-building-input">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ—Ä–ø—É—Å–∞ *</label>
                    <input type="text" id="new-building-input" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: E, –ù–æ–≤—ã–π" maxlength="10" style="width: 100%; padding: var(--spacing-sm);">
                    <div id="building-error" style="margin-top: var(--spacing-xs); color: #c00; font-size: var(--font-size-sm); display: none;"></div>
                    <div style="margin-top: var(--spacing-xs); font-size: var(--font-size-xs); color: var(--color-text-light);">
                        –î–ª–∏–Ω–∞: 1-10 —Å–∏–º–≤–æ–ª–æ–≤.
                    </div>
                </div>
                <div style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-lg);">
                    <button type="button" class="btn btn-primary" onclick="saveNewBuilding()" style="flex: 1;">–î–æ–±–∞–≤–∏—Ç—å</button>
                    <button type="button" class="btn btn-secondary" onclick="hideAddBuildingModal()" style="flex: 1;">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –î–û–ë–ê–í–ò–¢–¨ –ö–ê–¢–ï–ì–û–†–ò–Æ -->
    <div id="add-category-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                <button class="modal-close" onclick="hideAddCategoryModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="new-category-input">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ *</label>
                    <input type="text" id="new-category-input" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –£–∫—Ä–∞—à–µ–Ω–∏—è" maxlength="20" style="width: 100%; padding: var(--spacing-sm);">
                    <div id="category-suggestions" style="margin-top: var(--spacing-xs); font-size: var(--font-size-sm); color: var(--color-text-light);"></div>
                    <div id="category-error" style="margin-top: var(--spacing-xs); color: #c00; font-size: var(--font-size-sm); display: none;"></div>
                    <div style="margin-top: var(--spacing-xs); font-size: var(--font-size-xs); color: var(--color-text-light);">
                        –¢–æ–ª—å–∫–æ –±—É–∫–≤—ã, –ø—Ä–æ–±–µ–ª—ã –∏ –¥–µ—Ñ–∏—Å—ã. –î–ª–∏–Ω–∞: 2-20 —Å–∏–º–≤–æ–ª–æ–≤.
                    </div>
                </div>
                <div style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-lg);">
                    <button type="button" class="btn btn-primary" onclick="saveNewCategory()" style="flex: 1;">–î–æ–±–∞–≤–∏—Ç—å</button>
                    <button type="button" class="btn btn-secondary" onclick="hideAddCategoryModal()" style="flex: 1;">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –î–û–ë–ê–í–ò–¢–¨ –°–ö–ò–î–ö–£ -->
    <div id="discount-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–î–æ–±–∞–≤–∏—Ç—å —Å–∫–∏–¥–∫—É</h3>
                <button class="modal-close" onclick="hideAddDiscountModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
            <form id="discount-form">
                <div class="form-group">
                    <label for="discount-title">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∫–∏–¥–∫–∏ *</label>
                    <input type="text" id="discount-title" placeholder="24-—á–∞—Å–æ–≤–∞—è —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∞" required>
                </div>
                <div class="form-group">
                    <label for="discount-desc">–û–ø–∏—Å–∞–Ω–∏–µ *</label>
                    <textarea id="discount-desc" placeholder="20% –Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="discount-date">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                    <input type="date" id="discount-date">
                </div>
                <div class="form-group">
                    <label for="discount-product">–ù–∞ –∫–∞–∫–æ–π —Ç–æ–≤–∞—Ä</label>
                    <input type="text" id="discount-product" placeholder="–í—Å–µ —Ç–æ–≤–∞—Ä—ã / –í–µ—Ä—Ö–Ω—è—è –æ–¥–µ–∂–¥–∞ / –∏ —Ç.–¥.">
                </div>
                <div style="display: flex; gap: var(--spacing-md);">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">–î–æ–±–∞–≤–∏—Ç—å</button>
                    <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="hideAddDiscountModal()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –°–ö–†–ò–ü–¢–´ -->
    <script src="js/pwa.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/data.js"></script>
    <script src="js/admin.js"></script>

    <script>
        // ============================================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò
        // ============================================================
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Admin: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏');
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º API –∏–∑ admin.js
            if (window.Admin && typeof window.Admin.init === 'function') {
                try {
                    window.Admin.init();
                } catch (error) {
                    console.error('‚ùå Admin: –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏', error);
                }
            } else {
                console.warn('Admin: window.Admin.init –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
        });

        // ============================================================
        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø UI
        // ============================================================

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–ø—É—Å–∞–º–∏
        const existingBuildings = ['A', 'B', 'C', 'D'];

        function showAddBuildingModal() {
            document.getElementById('add-building-modal').style.display = 'flex';
            document.getElementById('new-building-input').value = '';
            document.getElementById('building-error').style.display = 'none';
            document.getElementById('new-building-input').focus();
        }

        function hideAddBuildingModal() {
            document.getElementById('add-building-modal').style.display = 'none';
        }

        function validateBuilding(input) {
            const cleaned = input.trim();
            
            if (cleaned.length < 1 || cleaned.length > 10) {
                return { valid: false, error: '–î–ª–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 1 –¥–æ 10 —Å–∏–º–≤–æ–ª–æ–≤' };
            }
            
            if (existingBuildings.includes(cleaned.toUpperCase())) {
                return { valid: false, error: '–¢–∞–∫–æ–π –∫–æ—Ä–ø—É—Å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' };
            }
            
            return { valid: true, cleaned: cleaned };
        }

        function saveNewBuilding() {
            const input = document.getElementById('new-building-input').value;
            const errorDiv = document.getElementById('building-error');
            
            const validation = validateBuilding(input);
            
            if (!validation.valid) {
                errorDiv.textContent = validation.error;
                errorDiv.style.display = 'block';
                return;
            }
            
            const buildingSelect = document.getElementById('building-select');
            const newOption = document.createElement('option');
            const buildingValue = validation.cleaned.toUpperCase();
            newOption.value = buildingValue;
            newOption.textContent = '–ö–æ—Ä–ø—É—Å ' + buildingValue;
            
            buildingSelect.appendChild(newOption);
            buildingSelect.value = buildingValue;
            existingBuildings.push(buildingValue);
            
            alert('–ö–æ—Ä–ø—É—Å "' + buildingValue + '" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
            hideAddBuildingModal();
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏
        const existingCategories = [
            '–æ–¥–µ–∂–¥–∞', '–æ–±—É–≤—å', '–∞–∫—Å–µ—Å—Å—É–∞—Ä—ã', '—ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞', '–∫–æ—Å–º–µ—Ç–∏–∫–∞', '—Å–ø–æ—Ä—Ç', '–ø—Ä–æ—á–µ–µ'
        ];

        function showAddCategoryModal() {
            document.getElementById('add-category-modal').style.display = 'flex';
            document.getElementById('new-category-input').value = '';
            document.getElementById('category-error').style.display = 'none';
            document.getElementById('category-suggestions').textContent = '';
            document.getElementById('new-category-input').focus();
        }

        function hideAddCategoryModal() {
            document.getElementById('add-category-modal').style.display = 'none';
        }

        function validateCategory(input) {
            // –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –∏ –ø—Ä–∏–≤–æ–¥–∏–º –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
            const cleaned = input.trim().toLowerCase().replace(/\s+/g, ' ');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã
            if (cleaned.length < 2 || cleaned.length > 20) {
                return { valid: false, error: '–î–ª–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç 2 –¥–æ 20 —Å–∏–º–≤–æ–ª–æ–≤' };
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã (—Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, –ø—Ä–æ–±–µ–ª—ã, –¥–µ—Ñ–∏—Å—ã)
            if (!/^[–∞-—è—ëa-z\s-]+$/i.test(cleaned)) {
                return { valid: false, error: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, –ø—Ä–æ–±–µ–ª—ã –∏ –¥–µ—Ñ–∏—Å—ã' };
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã
            if (existingCategories.includes(cleaned)) {
                return { valid: false, error: '–¢–∞–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç' };
            }
            
            return { valid: true, cleaned: cleaned };
        }

        function getSimilarCategories(input) {
            if (!input || input.length < 2) return [];
            
            const normalized = input.toLowerCase();
            return existingCategories.filter(cat => 
                cat.includes(normalized) || normalized.includes(cat)
            );
        }

        // –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –≤–≤–æ–¥–µ
        document.addEventListener('DOMContentLoaded', () => {
            const categoryInput = document.getElementById('new-category-input');
            if (categoryInput) {
                categoryInput.addEventListener('input', (e) => {
                    const value = e.target.value.trim();
                    const suggestionsDiv = document.getElementById('category-suggestions');
                    const errorDiv = document.getElementById('category-error');
                    
                    if (value.length >= 2) {
                        const similar = getSimilarCategories(value);
                        if (similar.length > 0) {
                            suggestionsDiv.textContent = '–ü–æ—Ö–æ–∂–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: ' + similar.join(', ');
                            suggestionsDiv.style.color = '#ff6b35';
                        } else {
                            suggestionsDiv.textContent = '';
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
                        const validation = validateCategory(value);
                        if (!validation.valid) {
                            errorDiv.textContent = validation.error;
                            errorDiv.style.display = 'block';
                        } else {
                            errorDiv.style.display = 'none';
                        }
                    } else {
                        suggestionsDiv.textContent = '';
                        errorDiv.style.display = 'none';
                    }
                });
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            const categorySelect = document.getElementById('category-select');
            if (categorySelect) {
                categorySelect.addEventListener('change', (e) => {
                    document.getElementById('category-input').value = e.target.value;
                });
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –∫–æ—Ä–ø—É—Å–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ —ç—Ç–∞–∂–∞ –¥–ª—è –∫–æ—Ä–ø—É—Å–∞ 33
            const buildingSelect = document.getElementById('building-select');
            const floorInput = document.getElementById('floor-input');
            const floorPlanContainer = document.getElementById('floor-plan-container');
            
            if (buildingSelect) {
                buildingSelect.addEventListener('change', (e) => {
                    selectBuilding(e.target.value);
                });
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —ç—Ç–∞–∂–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –ø–ª–∞–Ω
            if (floorInput) {
                floorInput.addEventListener('change', (e) => {
                    selectFloor(e.target.value);
                });
            }
        });

        function hideAddCategoryModal() {
            document.getElementById('add-category-modal').style.display = 'none';
        }

        function saveNewCategory() {
            const input = document.getElementById('new-category-input').value;
            const errorDiv = document.getElementById('category-error');
            
            const validation = validateCategory(input);
            
            if (!validation.valid) {
                errorDiv.textContent = validation.error;
                errorDiv.style.display = 'block';
                return;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤ —Å–ø–∏—Å–æ–∫
            const categorySelect = document.getElementById('category-select');
            const newOption = document.createElement('option');
            const categoryValue = validation.cleaned.replace(/\s+/g, '-');
            newOption.value = categoryValue;
            newOption.textContent = validation.cleaned.charAt(0).toUpperCase() + validation.cleaned.slice(1);
            
            // –í—Å—Ç–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ–ø—Ü–∏–µ–π (–∫–æ—Ç–æ—Ä–∞—è –º–æ–∂–µ—Ç –±—ã—Ç—å "–ü—Ä–æ—á–µ–µ")
            categorySelect.appendChild(newOption);
            
            // –í—ã–±–∏—Ä–∞–µ–º –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            categorySelect.value = categoryValue;
            document.getElementById('category-input').value = categoryValue;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤ —Å–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö
            existingCategories.push(validation.cleaned);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            alert('–ö–∞—Ç–µ–≥–æ—Ä–∏—è "' + newOption.textContent + '" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!');
            
            hideAddCategoryModal();
        }

        function showAddDiscountModal() {
            document.getElementById('discount-modal').style.display = 'flex';
        }

        function hideAddDiscountModal() {
            document.getElementById('discount-modal').style.display = 'none';
            if (document.getElementById('discount-form')) {
                document.getElementById('discount-form').reset();
            }
        }

        function handleLogout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                if (window.Auth && typeof window.Auth.logout === 'function') {
                    window.Auth.logout();
                }
            }
        }

        function selectFloor(floor) {
            document.querySelectorAll('.floor-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-floor="${floor}"]`).classList.add('active');
            
            if (window.Admin && typeof window.Admin.selectFloor === 'function') {
                window.Admin.selectFloor(floor);
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ñ–æ–Ω
        window.addEventListener('click', (e) => {
            const modal = document.getElementById('discount-modal');
            if (e.target === modal) {
                hideAddDiscountModal();
            }
        });
    </script>
</body>
</html>
