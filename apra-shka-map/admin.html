<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ê–ø—Ä–∞—à–∫–∏ ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–≤–∏–ª—å–æ–Ω–∞–º–∏ –∏ —Å–∫–∏–¥–∫–∞–º–∏">
    <meta name="theme-color" content="#000000">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Äî –ö–∞—Ä—Ç–∞ –ê–ø—Ä–∞—à–∫–∏</title>
    
    <!-- Supabase Configuration (–ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ meta —Ç–µ–≥–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏) -->
    <meta name="supabase-anon-key" content="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFhZ3B1dWNkbmtyendzbW5ieW1rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA1MDMxMjYsImV4cCI6MjA4NjA3OTEyNn0.T3vEY9VfxIQ19AtWPkwk6xiqAZe6sEzG-Ke73olUPsY">
    <meta name="supabase-url" content="https://qagpuucdnkrzwsmnbymk.supabase.co">
    
    <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Supabase –∏–∑ <meta> —Ç–µ–≥–æ–≤ -->
    <script>
            window.SupabaseConfig = {
                url: document.querySelector('meta[name="supabase-url"]').content.trim(),
                anonKey: document.querySelector('meta[name="supabase-anon-key"]').content.trim()
            };
    </script>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-mobile-web-app-status-bar-style" content="black">
    
    <!-- –°—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/admin.css">
</head>
<body>
    <!-- –®–ê–ü–ö–ê –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò -->
    <header class="admin-header">
        <div class="admin-header-title">
            <h1>üè¢ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
        </div>
        <div class="admin-header-user" id="user-info">
            <span id="user-name">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            <button class="btn btn-primary" onclick="handleLogout()">üö™ –í—ã—Ö–æ–¥</button>
        </div>
    </header>

    <!-- –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ù–¢ -->
    <main class="app-main">
        <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
        <section class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="stat-pavilions">0</div>
                <div class="stat-label">–ü–∞–≤–∏–ª—å–æ–Ω–æ–≤</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="stat-discounts">0</div>
                <div class="stat-label">–°–∫–∏–¥–æ–∫</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="stat-views">0</div>
                <div class="stat-label">–ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</div>
            </div>
        </section>

        <!-- –û–°–ù–û–í–ù–ê–Ø –†–ê–ó–ú–ï–¢–ö–ê: –î–í–ï –ö–û–õ–û–ù–ö–ò -->
        <div class="admin-container">
            <!-- –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –§–û–†–ú–ê –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø -->
            <div class="edit-panel">
                <h2 class="admin-section-title">‚úèÔ∏è –ü–∞–≤–∏–ª—å–æ–Ω</h2>

                <form id="pavilion-form">
                    <!-- –≠–¢–ê–ñ -->
                    <div class="form-group">
                        <label for="floor-input">–≠—Ç–∞–∂</label>
                        <select id="floor-input" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–∂</option>
                            <option value="1">1 —ç—Ç–∞–∂</option>
                            <option value="2">2 —ç—Ç–∞–∂</option>
                            <option value="3">3 —ç—Ç–∞–∂</option>
                            <option value="4">4 —ç—Ç–∞–∂</option>
                            <option value="5">5 —ç—Ç–∞–∂</option>
                        </select>
                    </div>

                    <!-- –ù–û–ú–ï–† –ü–ê–í–ò–õ–¨–û–ù–ê -->
                    <div class="form-group">
                        <label for="location-input">–ù–æ–º–µ—Ä –ø–∞–≤–∏–ª—å–æ–Ω–∞ (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ)</label>
                        <input type="text" id="location-input" readonly placeholder="–ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–∞—Ä—Ç–µ">
                    </div>

                    <!-- –ù–ê–ó–í–ê–ù–ò–ï –ú–ê–ì–ê–ó–ò–ù–ê -->
                    <div class="form-group">
                        <label for="name-input">–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞ *</label>
                        <input type="text" id="name-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞" required>
                    </div>

                    <!-- –ö–ê–¢–ï–ì–û–†–ò–Ø -->
                    <div class="form-group">
                        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                        <div class="category-chips" id="category-chips">
                            <button type="button" class="category-chip" data-category="clothing">üëï –û–¥–µ–∂–¥–∞</button>
                            <button type="button" class="category-chip" data-category="shoes">üëû –û–±—É–≤—å</button>
                            <button type="button" class="category-chip" data-category="accessories">‚ú® –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</button>
                            <button type="button" class="category-chip" data-category="electronics">üì± –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</button>
                            <button type="button" class="category-chip" data-category="cosmetics">üíÑ –ö–æ—Å–º–µ—Ç–∏–∫–∞</button>
                            <button type="button" class="category-chip" data-category="sports">‚öΩ –°–ø–æ—Ä—Ç</button>
                            <button type="button" class="category-chip" data-category="other">üì¶ –ü—Ä–æ—á–µ–µ</button>
                        </div>
                        <input type="hidden" id="category-input" required>
                    </div>

                    <!-- –¶–í–ï–¢ –ë–†–ï–ù–î–ò–†–û–í–ê–ù–ò–Ø -->
                    <div class="form-group">
                        <label>–¶–≤–µ—Ç –±—Ä–µ–Ω–¥–∏—Ä–æ–≤–∞–Ω–∏—è</label>
                        <div class="color-palette" id="color-palette">
                            <div class="color-option" style="background: #E91E63" data-color="#E91E63" title="–†–æ–∑–æ–≤—ã–π"></div>
                            <div class="color-option" style="background: #9C27B0" data-color="#9C27B0" title="–§–∏–æ–ª–µ—Ç–æ–≤—ã–π"></div>
                            <div class="color-option" style="background: #2196F3" data-color="#2196F3" title="–°–∏–Ω–∏–π"></div>
                            <div class="color-option" style="background: #00BCD4" data-color="#00BCD4" title="–ì–æ–ª—É–±–æ–π"></div>
                            <div class="color-option" style="background: #4CAF50" data-color="#4CAF50" title="–ó–µ–ª—ë–Ω—ã–π"></div>
                            <div class="color-option" style="background: #8BC34A" data-color="#8BC34A" title="–°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π"></div>
                            <div class="color-option" style="background: #FFC107" data-color="#FFC107" title="–ñ—ë–ª—Ç—ã–π"></div>
                            <div class="color-option" style="background: #FF9800" data-color="#FF9800" title="–û—Ä–∞–Ω–∂–µ–≤—ã–π"></div>
                            <div class="color-option" style="background: #FF5722" data-color="#FF5722" title="–ö—Ä–∞—Å–Ω–æ-–æ—Ä–∞–Ω–∂–µ–≤—ã–π"></div>
                            <div class="color-option" style="background: #F44336" data-color="#F44336" title="–ö—Ä–∞—Å–Ω—ã–π"></div>
                            <div class="color-option" style="background: #795548" data-color="#795548" title="–ö–æ—Ä–∏—á–Ω–µ–≤—ã–π"></div>
                            <div class="color-option" style="background: #9E9E9E" data-color="#9E9E9E" title="–°–µ—Ä—ã–π"></div>
                        </div>
                        <input type="hidden" id="brand-color-input" value="#FF6B35">
                    </div>

                    <!-- –ó–ê–ì–†–£–ó–ö–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø -->
                    <div class="form-group">
                        <label for="image-input">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–º–∞–∫—Å. 2 –ú–ë)</label>
                        <div class="image-upload-area" onclick="document.getElementById('image-input').click()">
                            <p>üì∏ –ö–ª–∏–∫–Ω–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</p>
                        </div>
                        <input type="file" id="image-input" accept="image/*" style="display: none;">
                        <img id="image-preview" class="image-preview" style="display: none;">
                    </div>

                    <!-- –°–ö–ò–î–ö–ò -->
                    <div class="form-group">
                        <label>–°–∫–∏–¥–∫–∏ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</label>
                        <div id="discounts-container">
                            <div class="discounts-list" id="discounts-list">
                                <p style="color: var(--color-text-light); font-size: var(--font-size-sm);">
                                    –°–∫–∏–¥–æ–∫ –Ω–µ—Ç
                                </p>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary" style="width: 100%; margin-top: var(--spacing-md);" onclick="showAddDiscountModal()">
                            ‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–∫–∏–¥–∫—É
                        </button>
                    </div>

                    <!-- –ö–ù–û–ü–ö–ò -->
                    <div style="display: flex; gap: var(--spacing-md); margin-top: var(--spacing-xl);">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button type="reset" class="btn btn-secondary" style="flex: 1;">‚Ü∫ –û—Ç–º–µ–Ω–∞</button>
                    </div>
                </form>
            </div>

            <!-- –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê: –ü–†–ï–î–ü–†–û–ú–û–¢–† –ö–ê–†–¢–´ -->
            <div class="preview-panel">
                <h2 class="admin-section-title">üó∫Ô∏è –ö–∞—Ä—Ç–∞</h2>

                <!-- –í–´–ë–û–† –≠–¢–ê–ñ–ê -->
                <div class="map-section">
                    <h3>–í—ã–±–µ—Ä–∏—Ç–µ —ç—Ç–∞–∂:</h3>
                    <div class="floor-selector" id="floor-selector">
                        <button class="floor-btn active" data-floor="1" onclick="selectFloor(1)">1 —ç—Ç–∞–∂</button>
                        <button class="floor-btn" data-floor="2" onclick="selectFloor(2)">2 —ç—Ç–∞–∂</button>
                        <button class="floor-btn" data-floor="3" onclick="selectFloor(3)">3 —ç—Ç–∞–∂</button>
                        <button class="floor-btn" data-floor="4" onclick="selectFloor(4)">4 —ç—Ç–∞–∂</button>
                        <button class="floor-btn" data-floor="5" onclick="selectFloor(5)">5 —ç—Ç–∞–∂</button>
                    </div>
                </div>

                <!-- –ö–ê–†–¢–ê –ú–ò–ù–ò–ê–¢–Æ–†–ê -->
                <div class="map-section">
                    <div class="map-container-mini" id="map-mini">
                        <div class="map-hint">
                            <p>üìç –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–µ, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é –ø–∞–≤–∏–ª—å–æ–Ω–∞</p>
                        </div>
                        <div id="mini-map" style="width:100%; height:300px;"></div>
                    </div>
                </div>

                <!-- –ò–ù–§–û–†–ú–ê–¶–ò–Ø -->
                <div style="margin-top: var(--spacing-lg); padding: var(--spacing-md); background: var(--color-bg-light); border-radius: var(--radius-md);">
                    <p style="font-size: var(--font-size-sm); margin: 0;">
                        <strong>üí° –°–æ–≤–µ—Ç:</strong> –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–µ —Å–ø—Ä–∞–≤–∞ –≤ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–∞—à–µ–≥–æ –ø–∞–≤–∏–ª—å–æ–Ω–∞.
                    </p>
                </div>
            </div>
        </div>

        <!-- –°–ü–ò–°–û–ö –ü–ê–í–ò–õ–¨–û–ù–û–í -->
        <section class="pavilions-list-section">
            <h2 class="admin-section-title">üìã –ú–æ–∏ –ø–∞–≤–∏–ª—å–æ–Ω—ã</h2>
            
            <div style="overflow-x: auto;">
                <table class="pavilions-table" id="pavilions-table">
                    <thead>
                        <tr>
                            <th>–≠—Ç–∞–∂</th>
                            <th>–ù–æ–º–µ—Ä</th>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th>–°–∫–∏–¥–∫–∏</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="pavilions-table-body">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: var(--spacing-lg); color: var(--color-text-light);">
                                –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞–≤–∏–ª—å–æ–Ω–æ–≤...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û: –î–û–ë–ê–í–ò–¢–¨ –°–ö–ò–î–ö–£ -->
    <div id="discount-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–∫–∏–¥–∫—É</h3>
                <button class="modal-close" onclick="hideAddDiscountModal()">‚úï</button>
            </div>
            <form id="discount-form">
                <div class="form-group">
                    <label for="discount-title">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∫–∏–¥–∫–∏ *</label>
                    <input type="text" id="discount-title" placeholder="24-—á–∞—Å–æ–≤–∞—è —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∞" required>
                </div>
                <div class="form-group">
                    <label for="discount-desc">–û–ø–∏—Å–∞–Ω–∏–µ *</label>
                    <textarea id="discount-desc" placeholder="20% –Ω–∞ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label for="discount-date">–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è</label>
                    <input type="date" id="discount-date">
                </div>
                <div class="form-group">
                    <label for="discount-product">–ù–∞ –∫–∞–∫–æ–π —Ç–æ–≤–∞—Ä</label>
                    <input type="text" id="discount-product" placeholder="–í—Å–µ —Ç–æ–≤–∞—Ä—ã / –í–µ—Ä—Ö–Ω—è—è –æ–¥–µ–∂–¥–∞ / –∏ —Ç.–¥.">
                </div>
                <div style="display: flex; gap: var(--spacing-md);">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">–î–æ–±–∞–≤–∏—Ç—å</button>
                    <button type="button" class="btn btn-secondary" style="flex: 1;" onclick="hideAddDiscountModal()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>
    </div>

    <!-- –°–ö–†–ò–ü–¢–´ -->
    <script src="js/pwa.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/data.js"></script>
    <script src="js/admin.js"></script>

    <script>
        // ============================================================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò
        // ============================================================
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Admin: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏');
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º API –∏–∑ admin.js
            if (window.Admin && typeof window.Admin.init === 'function') {
                try {
                    window.Admin.init();
                } catch (error) {
                    console.error('‚ùå Admin: –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏', error);
                }
            } else {
                console.warn('‚ö†Ô∏è Admin: window.Admin.init –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
        });

        // ============================================================
        // –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø UI
        // ============================================================

        function showAddDiscountModal() {
            document.getElementById('discount-modal').style.display = 'flex';
        }

        function hideAddDiscountModal() {
            document.getElementById('discount-modal').style.display = 'none';
            if (document.getElementById('discount-form')) {
                document.getElementById('discount-form').reset();
            }
        }

        function handleLogout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                if (window.Auth && typeof window.Auth.logout === 'function') {
                    window.Auth.logout();
                }
            }
        }

        function selectFloor(floor) {
            document.querySelectorAll('.floor-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-floor="${floor}"]`).classList.add('active');
            
            if (window.Admin && typeof window.Admin.selectFloor === 'function') {
                window.Admin.selectFloor(floor);
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ñ–æ–Ω
        window.addEventListener('click', (e) => {
            const modal = document.getElementById('discount-modal');
            if (e.target === modal) {
                hideAddDiscountModal();
            }
        });
    </script>
</body>
</html>
